---
title: "Bellabeat, Analysis Data Proyect"
author: "Fabián Cornejo, Data analyst"
date: "2024-04-03"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## About Company

Bellabeat, una empresa de alta tecnología que fabrica productos inteligentes focalizados en el cuidado de la salud. Desarrolla tecnología con un bonito diseño que informará e inspirará a las mujeres de todo el mundo. Recopilar datos sobre la actividad física, el sueño, el estrés y la salud reproductiva le ha permitido a Bellabeat proporcionar a las mujeres conocimientos sobre su propia salud y sus hábitos.

Los productos fabricados por Bellabeat son; *Aplicación Bellabeat*, *'Leaf'* dispositivo de seguimiento, *'Time'* el reloj de beniestar, *'Spring'* botella de agua inteligente. Además ofrecen una membresia con trato y seguimiento especial para los usuarios. 

Desde su fundación, en 2013, Bellabeat creció a un ritmo vertiginoso y rápidamente se posicionó como empresa de bienestar impulsada por la tecnología para las mujeres.

## Analysis Questions
* ¿Qué tendencias se encuentran en el uso de estos dispositivos inteligentes? 
* ¿Cómo aplicar dichas tendencias para mejorar el beniestar de los clientes?
* ¿Cómo ayudarian estas tendencias a la estrategia de Marketing de la empresa?

## Bussines Task. What need we to solve?

La empresa es pequeña pero existosa, necesitamos **encontrar oportunidades de 
crecimiento** en los datos y dar **recomendaciones a la estrategia de Marketing de Bellabeat**. Todo esto basado en las tendencias de los datos en el uso de los dispositivos inteligentes vendidos por Bellabeat. 

## Cleaning and Processing Data

Los archivos correspondientes en el proceso son

* **DailyActivity_merged**: Diferentes tipos de datos relacionados a los pasos y distancias recorridas diarias. 
* **HourlySteps**: Pasos totales por hora, con su respectivo usuario y fecha.
* **info_peso**: Peso de cada usuario con fecha.
* **intensidad_diaria**: Intensidad de cada usuario por fecha y hora; liviana, moderada e intensa. También las horas de sedentarismo.
* **SleepDay**: Minutos de sueño y cama de cada usuario por día.
* **Hourly_Intensities**: Actividad por hora.


Importamos librerias

```{r}
library(tidyverse)
library(lubridate)
library(readxl)
```

Limpiamos y procesamos 'info_emerged', en este caso tenemos dos archivos de datos separados el cual necesitamos unir para obtener la completitud de estos datos, se utiliza R y SQl.

```{r}
info_1 <- read.csv('C:\\Yop\\Analisis_de_datos\\Fitabase_Data_1\\Info_merged_1.csv')
str(info_1)

# Eliminamos valores nulos, y escogemos las columnas a utilizar
info_01 <- info_1 %>%
  drop_na() %>%
  distinct() %>%
  separate(Date, into = c("Date", "Hour"), sep = " ") %>% # separamos la hora de las fechas
  select(Id, Date, WeightKg)
str(info_01)

write.csv(info_01, file = "info_1.csv")
```

Hacemos exactamente lo mismo para la info_merged_2. Una vez exportadas en el pc son trabajadas en SQL.

Aquí seleccionamos y cambiamos los nombres de las columnas. Cambiamos el tipo de dato caracter a Date a la fecha, y redondeamos el peso.

*Parse_date* para seleccionar el tipo de fecha m-d-y  
*Replace* para cambiar/eliminar comillas y nuevamente para cambiar / por -  
*Cast* cambiamos el tipo de dato string a float64  
*Round* para redondear decimales    

`SELECT  `  
&nbsp;&nbsp;`__Id__ AS Id,`    
&nbsp;&nbsp;`PARSE_DATE('%m-%d-%Y', REPLACE((REPLACE(__Date__, '"', '')), '/', '-')) AS Date_,`    
&nbsp;&nbsp;`ROUND(CAST(REPLACE(__WeightKg___, '"', '') AS float64), 2) AS WeightKg`    
`FROM `    
&nbsp;&nbsp;`'limpiezas-400601.Proyecto_0.info_1'`    
`ORDER BY`   
`Id, Date ASC` *   


Lo mismo para info_2.   
Cabe señalar info_1 tiene 33 filas mientras que info_2 tiene 67. Como ninguna fila se repite, da una totalidad de 100 filas en la union.

Unimos ambas datas en una sola

` SELECT` *    
`FROM (`      
&nbsp;&nbsp;`SELECT` *    
&nbsp;&nbsp;`FROM` `'Proyecto_0.info_1'`    
&nbsp;&nbsp;`WHERE Date_ BETWEEN '2016-03-25' AND '2016-04-12'`    
&nbsp;&nbsp;`UNION ALL`    
&nbsp;&nbsp;`SELECT` *    
&nbsp;&nbsp;`FROM` `'Proyecto_0.info_2'`    
&nbsp;&nbsp;`WHERE Date_ BETWEEN '2016-04-12' AND '2016-05-12'`    
`) AS info_total `     
`ORDER BY`     
&nbsp;&nbsp;`Id, Date_ ASC` *

Es decir, una vez procesado y limpiado Info_1 e Info_2, las unimos en su totalidad. Abajo imagenes más esclarecedoras  

Consulta info_1 procesada: 

![](Consulta_1.png)

Consulta info_2 procesada:  

![](Consulta_2.png)

Consulta info_total:  

![](Consulta_total.png)

Limpiamos y procesamos 'dailyIntensities' y 'HourlyIntensities'

```{r}
intensidad_diaria <- read.csv('C:\\Yop\\Analisis_de_datos\\Fitabase_Data_2\\dailyIntensities_merged.csv')
str(intensidad_diaria)

# quitamos valores nulos e iguales, pasamos columnas de minutos a horas y seleccionamos columnas a trabajar
intensidad_diaria <- intensidad_diaria %>%
  drop_na() %>%
  distinct() %>%
  mutate(SedentaryHours = SedentaryMinutes/60,
         LightlyActiveHours = LightlyActiveMinutes/60,
         FairlyActiveHour = FairlyActiveMinutes / 60,
         VeryActiveHour = VeryActiveMinutes / 60) %>%
  select(Id, ActivityDay, SedentaryHours, LightlyActiveHours, 
         FairlyActiveHour, VeryActiveHour)

intensidad_diaria$ActivityDay <- mdy(intensidad_diaria$ActivityDay)
```

Al cambiar el tipo de dato de caracter a fecha, lubridate da error para las 00:00Horas, por lo tanto da resultado NA, por eso veremos un error en el codigo, también es la razón de cambiar todo NA a 00:00:00 para que más adelante sea legible este caracter por la libreria.

```{r}
# hourlyintensities
intensidad_hora1 <- read.csv('C:\\Yop\\Analisis_de_datos\\Fitabase_Data_1\\hourlyIntensities_merged.csv')
intensidad_hora2 <- read.csv('C:\\Yop\\Analisis_de_datos\\Fitabase_Data_2\\hourlyIntensities_merged.csv')

intensidad_hora1$ActivityHour =  mdy_hms(intensidad_hora1$ActivityHour, quiet = TRUE)

intensidad_hora1 <- separate(intensidad_hora1, ActivityHour, into = c("Date", "Hour"), sep = " ")
intensidad_hora1$Hour[is.na(intensidad_hora1$Hour)] <- "00:00:00"
view(intensidad_hora1)

intensidad_hora2$ActivityHour =  mdy_hms(intensidad_hora2$ActivityHour, quiet = TRUE)
intensidad_hora2 <- separate(intensidad_hora2, ActivityHour, into = c("Date", "Hour"), sep = " ")
intensidad_hora2$Hour[is.na(intensidad_hora2$Hour)] <- "00:00:00"
view(intensidad_hora2)


intensidad_hora_total <- merge(x = intensidad_hora1, y = intensidad_hora2, all = TRUE) %>%
  distinct()

```

Terminamos de limpiar y procesar el resto de archivos (de manera análoga a lo que ya vimos).

## Data analysis

Cargamos los nuevos conjuntos de datos procesados

```{r}
Daily_Activity <- read.csv('C:\\Yop\\Analisis_de_datos\\Data unida - codigos SQL\\dailyactivity_merged_total.csv')
Hourly_Steps <- read.csv('C:\\Yop\\Analisis_de_datos\\Data unida - codigos SQL\\HourlySteps.csv')
Peso <- read.csv('C:\\Yop\\Analisis_de_datos\\Data unida - codigos SQL\\Info_peso.csv')
Intensidad_diaria <- read.csv('C:\\Yop\\Analisis_de_datos\\Data unida - codigos SQL\\Intensidad_diaria.csv')
Sleep_Day <- read.csv('C:\\Yop\\Analisis_de_datos\\Data unida - codigos SQL\\SleepDay.csv')

# Procesamos y analizamos Daily activity

str(Daily_Activity)

n_distinct(Daily_Activity$Id)
n_distinct(Peso$Id)
n_distinct(Intensidad_diaria$Id)
n_distinct(Sleep_Day$Id)
n_distinct(Hourly_Steps$Id)
```
Lamentablemente los usuarios del conjunto 'Peso' no logran ser ni la mitad de la mayoria de los conjuntos, por lo tanto no son significantes para el estudio.

```{r}
Daily_Activity <- select(Daily_Activity, Id, ActivityDate, TotalSteps,
                         SedentaryMinutes, Calories)

# Por alguna razón csv convierte Date a character, volvemos a cambiar el tipo de dato
Daily_Activity$ActivityDate <- ymd(Daily_Activity$ActivityDate)
#detectamos los dias y los agregamos a una nueva columna
Daily_Activity$dia_semana <- weekdays(Daily_Activity$ActivityDate)

#agregamos un factor de orden 
dias_semana <- c("lunes", "martes", "miércoles", "jueves", "viernes", "sábado",
                 "domingo")
Daily_Activity$dia_semana <- factor(Daily_Activity$dia_semana, levels = dias_semana)

promedio_activity <- Daily_Activity %>%
  group_by(dia_semana) %>%
  summarise(Pasos_promedio = mean(TotalSteps),
            Calorias_promedios = mean(Calories))

## sleep day
Sleep_Day <- Sleep_Day %>%
  select( Id, Date, MinutesSleep, TimeInBed) %>%
  rename(Horas_durmiendo = MinutesSleep,
         Horas_en_cama = TimeInBed) %>%
  group_by(Id) %>%
  arrange(Id)

## hourly steps
Hourly_Steps <- select(Hourly_Steps, Id, Date, Hour, StepTotal)
Intensidad_diaria <- select(Intensidad_diaria, Id, ActivityDay, 
                            SedentaryHours, LightlyActiveHours, 
                            FairlyActiveHour, VeryActiveHour)
## Hourly Intensity 

# Nuevamente es irreconocible la fecha y hora, se soluciona y luego se pasan nuevamente a caracteres, con el fin de que quede ordenado y hacer graficos precisos a futuro
intensidad_hora_total$Date <- ymd(intensidad_hora_total$Date)
intensidad_hora_total$Hour <- hms(intensidad_hora_total$Hour)
intensidad_hora_total$Hour <- as.character(intensidad_hora_total$Hour)


summary(Daily_Activity)
summary(Sleep_Day)
summary(Hourly_Steps)
summary(Intensidad_diaria)
```  

#### Interesting Data
* El promedio de 7300 pasos esta por debajo de lo recomendado por la OMS, para una vida activa se recomiendan 10.000 pasos diarios minimo. 
* El promedio de horas dormidas esta al borde de lo minimo diario para cada persona, *National Sleep Foundation* recomienda dormir entre 7-9 horas. Las horas en cama no se distancian mucho de estos resultados. Hay una/s persona/s que ha dormido como mínimo y máximo afuera de lo recomendado, 1 hora y 13horas, respectivamente. 
* Las horas de sedentarismo en promedio son de 16 horas, es decir, que al menos hay 9 horas de sedentarismo activo. Ya que claramente no se puede ser activo en las horas de sueño. Las personas suelen ser ligeramente activas con un promedio de 3 horas y 12 minutos. La actividad promedio moderada e intensa suman un total de 30min diarios.  


## Visualization

```{r}
ggplot(Daily_Activity, aes(x = TotalSteps, y = Calories, colour = 'orange')) +
  geom_point()  + geom_smooth() +
  labs(title = 'Más pasos, más calorias quemadas', x = 'Pasos Totales', y = 'Calorias') +
  theme(legend.position = "none") +
  scale_y_continuous(trans = "log10") + 
  annotate("text", x = 15000, y = 20, label = 'Se ha agregado la transformación log10 para una mejor visualización', hjust = 0, vjust = 1, size = 3, color = "black")

ggplot(data = promedio_activity, aes(x = dia_semana, y = Pasos_promedio, fill = 'orange')) + 
  geom_bar(stat = 'identity') +
  theme(axis.text.x = element_text(angle = 0), legend.position = "none") +
  labs(x = "Dia de la semana" , y = "Pasos promedio", 
       title="¿En qué día de la semana se dan más o menos pasos?")

```  

Aunque obvio, se confirma que entre más pasos mayor calorias son quemadas/eliminadas.
Además los pasos promedio son estables todos los dias, sin importar si es dia trabajable o fin de semana, esto muestra una tendencia de sedentarismo antes que otro factor.  
**Si los usuarios quieren revertir el sedentarismo se podria recomendar salir a caminar/quemar calorias, en los aparatos inteligentes de Bellbeat con una notificación diaría o propuesta por el mismo usuario.**  

```{r}
# damos un factor de orden, así el grafico esta en orden
intensidad_hora_total$Hour <- factor(intensidad_hora_total$Hour, levels = c("0S", "1H 0M 0S",
                                                          '2H 0M 0S',
                                                          "3H 0M 0S",
                                                          "4H 0M 0S", 
                                                          "5H 0M 0S", "6H 0M 0S", 
                                                          "7H 0M 0S", "8H 0M 0S", 
                                                          "9H 0M 0S", "10H 0M 0S",
                                                          "11H 0M 0S", "12H 0M 0S",
                                                          "13H 0M 0S", "14H 0M 0S",
                                                          "15H 0M 0S", "16H 0M 0S",
                                                          "17H 0M 0S", "18H 0M 0S",
                                                          "19H 0M 0S", "20H 0M 0S",
                                                          "21H 0M 0S", "22H 0M 0S",
                                                          "23H 0M 0S", "24H 0M 0S"))

Intensidad_hora <- intensidad_hora_total %>%
  group_by(Hour) %>%
  summarise(TotalIntensity_promedio = mean(TotalIntensity))

ggplot(data = Intensidad_hora, aes(x = Hour, y = TotalIntensity_promedio)) +
  geom_bar(stat = "identity", fill='purple') +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title="¿Cuándo hay mayor actividad en el día?", x = 'Hora', y = 'Intensidad Promedio')
```

Para ser aun mas exactos, podemos observar que la **mayor intensidad se da entre las 17 y 19 horas**. Momento donde **se podrian enviar notificaciones a los usuarios para recordarles salir a caminar o hacer ejercicio**. Momento ideal debido a que son horas donde la gente esta mayormente disponible, han termindo los quehaceres/trabajos del día.

```{r}
ggplot(Sleep_Day, aes(x = Horas_en_cama, y = Horas_durmiendo)) + 
  geom_point()  + geom_smooth() +
  labs(title = 'Ir a cama solo para dormir', x = "Horas en Cama", 
       y = "Horas durmiendo")
```

La relación entre ambos es lineal, tiempo en cama es practicamente tiempo durmiendo. Se podria **considerar usar una notificación para ir a la cama, asi mejorar el estado de sueño**, ya que el minimo de horas promedio para dormir estaba en su limite.

## Conclusion and Recommendations


Hemos recolectado información de los datos proporcionados por los aparatos inteligentes de Bellbeat, donde se muestran los habitos y así también la salud de los participantes. Con esto podemos dar algunas recomendaciones para mejorar los aparatos y asi en consecuencia hacer crecer aun más la empresa, es decir, recomendaciones que puedan ayudar a la estrategia de marketing de Bellbeat. 

Antes cabe señalar que el objetivo de audencia va inclinado hacia mujeres por parte de la empresa, pero no así el estudio. No hay información de géneros ni tampoco de algun grupo etario. Se asume que es para toda persona y edad (hasta incluidos enfermos cronicos). 


Entonces, la audencia es mayoritariamente sedentaria con alrededor de 8mil pasos diarios, y para una vida saludable es necesario 10mil. Además mayoritariamente son ligeramente activas, es necesario aumentar la actividad moderada e intensa. Con los datos obtenidos, podemos confirmar que el sedentarismo no es por falta de tiempo. Ahora bien los indices de sueño estan al borde, por el cual es necesario aumentar las horas de sueño. 

Por lo tanto, podemos recomendar 

* Si los usuarios desean revertir el sedentarismo o mantenerse saludable, se podria recomendar a los usuarios activar cumplir una cuota diaria de pasos, como mínimo los 10.000 recomendados por la OMS. Esto con el aparato "Time", el reloj inteligente. Así como también avisar si estan siendo demasiado sedentarios, tener un limite de pasos minimos apróx 6.000. 

* Se podria agregar una notificación de recordatorio de hacer ejercicio entre las 17:00 hrs y 19:00 hrs, donde mayoritariamente es cuando hay mayor actividad intensa en el día, ideal cuando la gente no esta en el trabajo o sin quehaceres cotidianos. A través del aparato "Leaf" para el seguimiento de la actividad física. 
Sumado a este punto, el aparato "spring" (la botella inteligente) podria recomendar hidratarse en algun momento de las horas recientemente señaladas.

* Confirmamos que estar en cama es proporcional de manera lineal a dormir, como las horas de sueño esta un poco por debajo a lo esperado, seria recomendable activar notificaciones "go to sleep" para poder mejorar estas horas de sueño. A demás con la membresia de Bellbeat, dar recomendaciones y consejos de como mejorar el tiempo para poder quedarse dormido, ya que hay un áproximado de 30 minutos en que las personas estan quedandose dormidas.

Finalmente, de manera generaliza, dar objetivos a través de notificaciones en los dispositivos inteligentes es una gran ayuda para incentivar a los usuarios a ser menos sedentarios, tener un mejor beniestar y salud en general. Así también atraer nuevos usuarios con todas las nuevas funciones de los dispositivos inteligentes de Bellbeat!


Thanks u for watching and reading my BellBeat case proyect with R :)



